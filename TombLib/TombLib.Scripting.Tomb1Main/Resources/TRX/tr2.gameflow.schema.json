{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TR2 gameflow schema",
  "type": "object",
  "properties": {
    "main_menu_picture": {
      "type": "string",
      "description": "Path to the main menu background image."
    },
    "savegame_fmt_legacy": {
      "type": "string",
      "description": "Path pattern to look for the original savegame files."
    },
    "savegame_fmt_bson": {
      "type": "string",
      "description": "Path pattern to look for the savegame files."
    },
    "cmd_init": {
      "$ref": "#/definitions/command",
      "description": "Command to run when the game is first launched."
    },
    "cmd_title": {
      "$ref": "#/definitions/command",
      "description": "Command to run when the main menu is shown."
    },
    "cmd_death_in_demo": {
      "$ref": "#/definitions/command",
      "description": "Command to run when Lara dies during a demo."
    },
    "cmd_death_in_game": {
      "$ref": "#/definitions/command",
      "description": "Command to run when Lara dies in game."
    },
    "cmd_demo_interrupt": {
      "$ref": "#/definitions/command",
      "description": "Command to run when the player interrupts a demo."
    },
    "cmd_demo_end": {
      "$ref": "#/definitions/command",
      "description": "Command to run when a demo finishes playback."
    },
    "cheat_keys": {
      "type": "boolean",
      "description": "Whether to enable original in-game cheat keys."
    },
    "load_save_disabled": {
      "type": "boolean",
      "description": "Whether to disable saving and loading the game."
    },
    "play_any_level": {
      "type": "boolean",
      "description": "Whether to show a full list of all levels in place of the New Game screen."
    },
    "lockout_option_ring": {
      "type": "boolean",
      "description": "Whether to disallow the player from using the option ring in-game."
    },
    "demo_version": {
      "type": "boolean",
      "description": "Legacy demo version flag (scheduled for removal)."
    },
    "single_level": {
      "type": "integer",
      "description": "Force the player to only play this one level."
    },
    "demo_delay": {
      "type": "number",
      "description": "Number of seconds to pass in the main menu before playing the demo."
    },
    "secret_track": {
      "type": "integer",
      "description": "Music track to play when a secret is found. -1 to disable."
    },
    "title": {
      "$ref": "#/definitions/title",
      "description": "Configuration for the title screen."
    },
    "sfx_path": {
      "type": "string",
      "description": "Path to the sound effects (.sfx) file to use in the game."
    },
    "injections": {
      "type": "array",
      "description": "Global data injection file paths applied to all levels unless overridden.",
      "items": {
        "type": "string"
      }
    },
    "levels": {
      "type": "array",
      "description": "Array of regular level definitions.",
      "items": {
        "$ref": "#/definitions/level"
      }
    },
    "cutscenes": {
      "type": "array",
      "description": "Array of cutscene level definitions.",
      "items": {
        "$ref": "#/definitions/level"
      }
    },
    "demos": {
      "type": "array",
      "description": "Array of demo level definitions.",
      "items": {
        "$ref": "#/definitions/level"
      }
    },
    "fmvs": {
      "type": "array",
      "description": "Array of FMV entries.",
      "items": {
        "$ref": "#/definitions/fmv"
      }
    },
    "enable_killer_pushblocks": {
      "type": "boolean",
      "description": "If enabled, when a pushblock falls from the air and lands on Lara, it will kill her outright."
    },
    "enforced_config": {
      "type": "object",
      "description": "Overrides for any regular game config settings.",
      "additionalProperties": true
    },
    "hidden_config": {
      "type": "array",
      "description": "List of config settings to hide from the in-game settings dialogs.",
      "items": {
        "type": "string"
      }
    },
    "fog_start": {
      "type": "number",
      "description": "The distance (in tiles) at which objects and the world start to fade into blackness."
    },
    "fog_end": {
      "type": "number",
      "description": "The distance (in tiles) at which objects and the world are clipped away."
    },
    "water_color": {
      "description": "Water color (R, G, B) or `#RRGGBB`. 1.0 or `FF` means pass-through, 0.0 or `00` means completely black color.",
      "oneOf": [
        {
          "type": "array",
          "items": {
            "type": "number"
          },
          "minItems": 3,
          "maxItems": 3
        },
        {
          "type": "string"
        }
      ]
    },
    "ambient_tracks": {
      "type": "array",
      "description": "List of music track IDs treated as ambient music (persists on save/load).",
      "items": {
        "type": "integer"
      }
    }
  },
  "required": [
    "main_menu_picture",
    "savegame_fmt_legacy",
    "savegame_fmt_bson"
  ],
  "additionalProperties": false,
  "definitions": {
    "command": {
      "type": "object",
      "properties": {
        "action": {
          "type": "string"
        },
        "param": {
          "type": [
            "integer",
            "string"
          ]
        }
      },
      "required": [
        "action"
      ],
      "additionalProperties": false
    },
    "title": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string"
        },
        "music_track": {
          "type": "integer"
        },
        "inherit_injections": {
          "type": "boolean"
        },
        "injections": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "sequence": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/sequence"
          }
        }
      },
      "required": [
        "path",
        "sequence"
      ],
      "additionalProperties": false
    },
    "level": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "path": {
          "type": "string"
        },
        "music_track": {
          "type": "integer"
        },
        "sequence": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/sequence"
          }
        },
        "inherit_injections": {
          "type": "boolean"
        },
        "injections": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ambient_tracks": {
          "type": "array",
          "items": {
            "type": "integer"
          }
        }
      },
      "anyOf": [
        {
          "properties": {
            "type": {
              "enum": [
                "current",
                "dummy"
              ]
            }
          }
        },
        {
          "properties": {
            "type": {
              "enum": [
                "title"
              ]
            }
          },
          "required": [
            "sequence"
          ]
        },
        {
          "required": [
            "path",
            "sequence"
          ]
        }
      ],
      "additionalProperties": false
    },
    "fmv": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string"
        },
        "legal": {
          "type": "boolean"
        }
      },
      "required": [
        "path"
      ],
      "additionalProperties": false
    },
    "sequence": {
      "oneOf": [
        {
          "$ref": "#/definitions/seq_loop_game"
        },
        {
          "$ref": "#/definitions/seq_level_complete"
        },
        {
          "$ref": "#/definitions/seq_exit_to_title"
        },
        {
          "$ref": "#/definitions/seq_level_stats"
        },
        {
          "$ref": "#/definitions/seq_total_stats"
        },
        {
          "$ref": "#/definitions/seq_display_picture"
        },
        {
          "$ref": "#/definitions/seq_loading_screen"
        },
        {
          "$ref": "#/definitions/seq_play_fmv"
        },
        {
          "$ref": "#/definitions/seq_give_item"
        },
        {
          "$ref": "#/definitions/seq_add_secret_reward"
        },
        {
          "$ref": "#/definitions/seq_play_music"
        },
        {
          "$ref": "#/definitions/seq_remove_ammo"
        },
        {
          "$ref": "#/definitions/seq_remove_weapons"
        },
        {
          "$ref": "#/definitions/seq_remove_medipacks"
        },
        {
          "$ref": "#/definitions/seq_remove_flares"
        },
        {
          "$ref": "#/definitions/seq_play_cutscene"
        },
        {
          "$ref": "#/definitions/seq_set_cutscene_angle"
        },
        {
          "$ref": "#/definitions/seq_enable_sunset"
        },
        {
          "$ref": "#/definitions/seq_set_lara_start_anim"
        },
        {
          "$ref": "#/definitions/seq_disable_floor"
        }
      ]
    },
    "seq_loop_game": {
      "type": "object",
      "description": "Plays the main game loop.",
      "properties": {
        "type": {
          "const": "loop_game"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_level_complete": {
      "type": "object",
      "description": "Ends the current level and plays the next one, if available.",
      "properties": {
        "type": {
          "const": "level_complete"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_exit_to_title": {
      "type": "object",
      "description": "Returns to the title level.",
      "properties": {
        "type": {
          "const": "exit_to_title"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_level_stats": {
      "type": "object",
      "description": "Displays the end of level statistics for the current level. In a Gym level, this fades the screen to black.",
      "properties": {
        "type": {
          "const": "level_stats"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_total_stats": {
      "type": "object",
      "description": "Displays the end of game statistics with the given picture file shown as a background.",
      "properties": {
        "type": {
          "const": "total_stats"
        },
        "background_path": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "background_path"
      ],
      "additionalProperties": false
    },
    "seq_display_picture": {
      "type": "object",
      "description": "Displays the specified picture for a fixed time. Files that are needed to function only with a specific aspect ratio can be placed in a directory adjacent to the main image, named according to the aspect ratio â€“ for example, 4x3/title.png or 16x10/title.png. The game won't attempt to match these precisely; instead, it will select the file with the aspect ratio closest to the game's viewport. The main image designated by path is presumed to have a 16:9 aspect ratio for this purpose, and as such there's no need for 16x9-specific directory. This logic applies to all images.",
      "properties": {
        "type": {
          "const": "display_picture"
        },
        "path": {
          "type": "string"
        },
        "display_time": {
          "type": "number"
        },
        "fade_in_time": {
          "type": "number"
        },
        "fade_out_time": {
          "type": "number"
        },
        "credit": {
          "type": "boolean"
        },
        "legal": {
          "type": "boolean"
        }
      },
      "required": [
        "type",
        "path"
      ],
      "additionalProperties": false
    },
    "seq_loading_screen": {
      "type": "object",
      "description": "Shows a picture prior to loading a level. Functions identically to display_picture, except these pictures can be enabled/disabled by the user with the loading screen option in the config tool.",
      "properties": {
        "type": {
          "const": "loading_screen"
        },
        "path": {
          "type": "string"
        },
        "display_time": {
          "type": "number"
        },
        "fade_in_time": {
          "type": "number"
        },
        "fade_out_time": {
          "type": "number"
        }
      },
      "required": [
        "type",
        "path"
      ],
      "additionalProperties": false
    },
    "seq_play_cutscene": {
      "type": "object",
      "description": "Plays the specified cinematic level (from the cutscenes).",
      "properties": {
        "type": {
          "const": "play_cutscene"
        },
        "cutscene_id": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "cutscene_id"
      ],
      "additionalProperties": false
    },
    "seq_play_fmv": {
      "type": "object",
      "description": "Plays the specified FMV. fmv_id must be a valid index into the fmvs root key.",
      "properties": {
        "type": {
          "const": "play_fmv"
        },
        "fmv_id": {
          "type": [
            "integer",
            "string"
          ]
        }
      },
      "required": [
        "type",
        "fmv_id"
      ],
      "additionalProperties": false
    },
    "seq_give_item": {
      "type": "object",
      "description": "Adds the specified item and quantity to Lara's inventory.",
      "properties": {
        "type": {
          "const": "give_item"
        },
        "object_id": {
          "type": [
            "integer",
            "string"
          ]
        },
        "quantity": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "object_id"
      ],
      "additionalProperties": false
    },
    "seq_add_secret_reward": {
      "type": "object",
      "description": "Adds the specified item to the current level's list of rewards for collecting all secrets.",
      "properties": {
        "type": {
          "const": "add_secret_reward"
        },
        "object_id": {
          "type": [
            "integer",
            "string"
          ]
        },
        "quantity": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "object_id"
      ],
      "additionalProperties": false
    },
    "seq_play_music": {
      "type": "object",
      "description": "Plays the given audio track.",
      "properties": {
        "type": {
          "const": "play_music"
        },
        "music_track": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "music_track"
      ],
      "additionalProperties": false
    },
    "seq_remove_ammo": {
      "type": "object",
      "description": "Any combination of these sequences can be used to modify Lara's inventory at the start of a level. `remove_weapons` does not remove the ammo for those guns, and `remove_ammo` does not remove the guns. Item removal is performed first, followed by addition.",
      "properties": {
        "type": {
          "const": "remove_ammo"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_remove_weapons": {
      "type": "object",
      "description": "Any combination of these sequences can be used to modify Lara's inventory at the start of a level. `remove_weapons` does not remove the ammo for those guns, and `remove_ammo` does not remove the guns. Item removal is performed first, followed by addition.",
      "properties": {
        "type": {
          "const": "remove_weapons"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_remove_medipacks": {
      "type": "object",
      "description": "Any combination of these sequences can be used to modify Lara's inventory at the start of a level. `remove_weapons` does not remove the ammo for those guns, and `remove_ammo` does not remove the guns. Item removal is performed first, followed by addition.",
      "properties": {
        "type": {
          "const": "remove_medipacks"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_remove_flares": {
      "type": "object",
      "description": "Any combination of these sequences can be used to modify Lara's inventory at the start of a level. `remove_weapons` does not remove the ammo for those guns, and `remove_ammo` does not remove the guns. Item removal is performed first, followed by addition.",
      "properties": {
        "type": {
          "const": "remove_flares"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_set_cutscene_angle": {
      "type": "object",
      "description": "Sets the camera's angle.",
      "properties": {
        "type": {
          "const": "set_cutscene_angle"
        },
        "angle": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "angle"
      ],
      "additionalProperties": false
    },
    "seq_enable_sunset": {
      "type": "object",
      "description": "Enables the sunset effect, like in Bartoli's Hideout. At present, this feature is hardcoded to gradually darken the game 40 minutes into playing a level.",
      "properties": {
        "type": {
          "const": "enable_sunset"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "seq_set_lara_start_anim": {
      "type": "object",
      "description": "Applies the selected animation to Lara when the level begins. This is used, for example, in the Offshore Rig of Tomb Raider II.",
      "properties": {
        "type": {
          "const": "set_lara_start_anim"
        },
        "anim": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "anim"
      ],
      "additionalProperties": false
    },
    "seq_disable_floor": {
      "type": "object",
      "description": "Configures a specific height (with 256 representing 1 click and 1024 representing 1 sector) to define an abyss that will invariably lead to Lara's death if she falls into it. Additionally, it employs special rendering to ensure it isn't treated as solid ground.",
      "properties": {
        "type": {
          "const": "disable_floor"
        },
        "height": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "height"
      ],
      "additionalProperties": false
    }
  }
}
